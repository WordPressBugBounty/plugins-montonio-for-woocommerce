(()=>{"use strict";const e=window.React,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"montonio-for-woocommerce/wc-montonio-shipping-dropdown","version":"0.1.0","title":"Montonio Shipping Pickup Point Dropdown Block","category":"woocommerce","description":"Adds a Montonio Shipping Pickup Point Dropdown to the checkout page.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"montonio-for-woocommerce","editorScript":"file:./index.js","viewScript":"file:./view.js"}'),t=window.wp.element,n=window.wp.i18n,i=window.wc.blocksCheckout,c=window.wp.data,s=window.lodash,{getSetting:r}=wc.wcSettings,a=(r("wc-montonio-shipping-dropdown_data",{}),{metadata:o,component:({checkoutExtensionData:o})=>{const[i,r]=(0,t.useState)(""),[a,p]=(0,t.useState)(!1),[l,m]=(0,t.useState)(!1),{setExtensionData:d}=o,u=(0,t.useRef)(null),h=(0,t.useRef)(null),w=(0,t.useRef)(!1),k="montonio-pickup-point",{setValidationErrors:_,clearValidationError:g}=(0,c.useDispatch)("wc/store/validation"),f=(0,c.useSelect)((e=>e("wc/store/validation").getValidationError(k))),{shippingMethodId:E,shippingCarrier:v,shippingAddress:P,isCustomerDataUpdating:S}=(0,c.useSelect)((e=>{const o=e("wc/store/cart"),t=o.getCartData(),n=t.shippingRates?.[0]?.shipping_rates?.find((e=>e.selected)),i=n?.meta_data?.find((e=>"provider_name"===e.key));return{shippingMethodId:n?.method_id||null,shippingCarrier:i?.value||null,shippingAddress:t.shippingAddress||{},isCustomerDataUpdating:o.isCustomerDataUpdating()}})),{isProcessing:b}=(0,c.useSelect)((e=>({isProcessing:e("wc/store/checkout").isProcessing()}))),C=(0,t.useCallback)((0,s.debounce)(((e,o,t)=>{d(e,o,t)}),1e3),[d]),y=(0,t.useCallback)((e=>{const o=e.detail;r(o.id),C("montonio-for-woocommerce","selected_pickup_point",o.id),m(!0),f&&g(k)}),[C,f,g,k]);(0,t.useEffect)((()=>{const e=h.current;if(e&&a)return e.addEventListener("montonio-pickup-point-selected",y),()=>{e.removeEventListener("montonio-pickup-point-selected",y)}}),[a,y]);const N=(0,t.useCallback)((e=>{const o=e.startsWith("montonio_")&&(e.endsWith("parcel_machines")||e.endsWith("parcel_shops")||e.endsWith("post_offices"));window.montonioPickupPointSelector&&(window.montonioPickupPointSelector.clearSelection(),window.montonioPickupPointSelector.destroy()),r(""),w.current=o,p(o)}),[]);(0,t.useEffect)((()=>{(E!==u.current||S)&&(N(E),u.current=E)}),[S,E,P,N]);const D=(0,t.useCallback)((()=>{document.getElementById("montonio-pickup-point__search")&&(window.montonioPickupPointSelector=new MontonioPickupPointSelector)}),[]);return(0,t.useEffect)((()=>{a&&w.current&&(w.current=!1,requestAnimationFrame((()=>{D()})))}),[a,E,D]),(0,t.useEffect)((()=>{a&&""===i?_({[k]:{message:(0,n.__)("Please select a pickup point","montonio-for-woocommerce"),hidden:!l}}):f&&g(k)}),[a,i,_,g,k,l,f]),(0,e.createElement)("div",{id:"montonio-pickup-point-block",className:"montonio-pickup-point "+(!1===f?.hidden?"has-error":"")},a&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"wc-block-components-checkout-step__heading"},(0,e.createElement)("h2",{className:"wc-block-components-title wc-block-components-checkout-step__title"},(0,n.__)("Pickup point","montonio-for-woocommerce"))),(0,e.createElement)("div",{className:"montonio-pickup-point__container"},(0,e.createElement)("input",{ref:h,type:"text",id:"montonio-pickup-point__search",className:`montonio-pickup-point__search montonio-pickup-point__search--${v||""}`,placeholder:(0,n.__)("Type at least 3 characters to search...","montonio-for-woocommerce"),autoComplete:"off","data-carrier":v||"","data-country":P.country||""}),(0,e.createElement)("div",{className:"montonio-pickup-point__dropdown",id:"montonio-pickup-point__dropdown"}),(0,e.createElement)("div",{className:"montonio-pickup-point__error montonio-pickup-point__error--hidden",id:"montonio-pickup-point__error"})),(0,e.createElement)("input",{type:"hidden",id:"montonio_pickup_point",className:"montonio-pickup-point__selected",name:"montonio-pickup-point"}),!1===f?.hidden&&(0,e.createElement)("div",{className:"wc-block-components-validation-error"},(0,e.createElement)("p",{id:"validate-error-montonio_pickup_point"},(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z"})),(0,e.createElement)("span",null,f.message)))))}});(0,i.registerCheckoutBlock)(a)})();