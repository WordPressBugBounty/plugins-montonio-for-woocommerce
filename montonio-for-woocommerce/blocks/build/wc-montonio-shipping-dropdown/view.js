(()=>{"use strict";const e=window.React,o=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"montonio-for-woocommerce/wc-montonio-shipping-dropdown","version":"0.1.0","title":"Montonio Shipping Pickup Point Dropdown Block","category":"woocommerce","description":"Adds a Montonio Shipping Pickup Point Dropdown to the checkout page.","supports":{"html":false,"align":false,"multiple":false,"reusable":false},"parent":["woocommerce/checkout-shipping-methods-block"],"attributes":{"lock":{"type":"object","default":{"remove":true,"move":true}}},"textdomain":"montonio-for-woocommerce","editorScript":"file:./index.js","viewScript":"file:./view.js"}'),t=window.wp.element,n=window.wp.i18n,i=window.wc.blocksCheckout,c=window.wp.data,r=window.lodash,a={metadata:o,component:({checkoutExtensionData:o})=>{const[i,a]=(0,t.useState)(""),[s,p]=(0,t.useState)(null),[l,d]=(0,t.useState)(!1),[m,u]=(0,t.useState)(!1),[h,w]=(0,t.useState)(null),{setExtensionData:k}=o,g=(0,t.useRef)(null),_=(0,t.useRef)(null),f=(0,t.useRef)(null),v=(0,t.useRef)(null),E=(0,t.useRef)(!1),S="montonio-pickup-point",y="montonio-pickup-point-cod",{setValidationErrors:b,clearValidationError:P}=(0,c.useDispatch)("wc/store/validation"),C=(0,c.useSelect)((e=>e("wc/store/validation").getValidationError(S))),N=(0,c.useSelect)((e=>e("wc/store/validation").getValidationError(y))),{shippingRateId:D,shippingCarrier:x,shippingCountry:R,shippingType:z,shippingOperators:M,isCustomerDataUpdating:O}=(0,c.useSelect)((e=>{const o=e("wc/store/cart"),t=o.getCartData(),n=t.shippingRates?.[0]?.shipping_rates?.find((e=>e.selected)),i=e=>n?.meta_data?.find((o=>o.key===e))?.value||null;return{shippingRateId:n?.rate_id||null,shippingCarrier:i("carrier_code"),shippingCountry:t.shippingAddress?.country||null,shippingType:i("type_v2"),shippingOperators:i("operators"),isCustomerDataUpdating:o.isCustomerDataUpdating()}})),{isProcessing:A}=(0,c.useSelect)((e=>({isProcessing:e("wc/store/checkout").isProcessing()})));(0,t.useEffect)((()=>{const e=()=>{const e=document.querySelector('input[name="radio-control-wc-payment-method-options"]:checked')?.value;w(e)};return e(),document.addEventListener("change",e),()=>{document.removeEventListener("change",e)}}),[]);const B=(0,t.useCallback)((0,r.debounce)(((e,o,t)=>{k(e,o,t)}),1e3),[k]),V=(0,t.useCallback)((e=>{const o=e.detail;a(o.id),p(o),B("montonio-for-woocommerce","selected_pickup_point",o.id),u(!0),C&&P(S)}),[B,C,P,S]);(0,t.useEffect)((()=>{const e=v.current;if(e&&l)return e.addEventListener("montonio-pickup-point-selected",V),()=>{e.removeEventListener("montonio-pickup-point-selected",V)}}),[l,V]);const j=(0,t.useCallback)(((e,o)=>{if(window.montonioPickupPointSelector&&(window.montonioPickupPointSelector.clearSelection(),window.montonioPickupPointSelector.destroy()),a(""),p(null),!e)return E.current=!1,void d(!1);const t=!!o&&["parcelMachine","postOffice","parcelShop"].includes(o);E.current=t,d(t)}),[]);(0,t.useEffect)((()=>{const e=!(0,r.isEqual)(f.current,M);(g.current!==D||_.current!==R||e)&&(j(D,z),g.current=D,_.current=R,f.current=M)}),[O,D,M,j]);const L=(0,t.useCallback)((()=>{document.getElementById("montonio-pickup-point__search-input")&&(window.montonioPickupPointSelector=new MontonioPickupPointSelector)}),[]);return(0,t.useEffect)((()=>{l&&E.current&&(E.current=!1,requestAnimationFrame((()=>{L()})))}),[O,l,D,M,L]),(0,t.useEffect)((()=>{l&&""===i?b({[S]:{message:(0,n.__)("Please select a pickup point","montonio-for-woocommerce"),hidden:!m}}):C&&P(S)}),[l,i,b,P,S,m,C]),(0,t.useEffect)((()=>{if(!l||!s||"cod"!==h)return void(N&&P(y));let e=!1;if(s.additionalServices)try{let o=s.additionalServices;"string"==typeof o&&(o=JSON.parse(o)),Array.isArray(o)&&(e=o.some((e=>"cod"===e.code)))}catch(e){console.error("Error parsing additional_services:",e)}e?N&&P(y):b({[y]:{message:(0,n.__)("Cash on Delivery is not available for the selected pickup point. Please choose a different pickup point or payment method.","montonio-for-woocommerce"),hidden:!1}})}),[l,s,h,b,P,y,N]),(0,e.createElement)("div",{id:"montonio-pickup-point-block",className:"montonio-pickup-point "+(!1===C?.hidden||!1===N?.hidden?"has-error":"")},l&&(0,e.createElement)(e.Fragment,null,(0,e.createElement)("div",{className:"wc-block-components-checkout-step__heading-container"},(0,e.createElement)("div",{className:"wc-block-components-checkout-step__heading"},(0,e.createElement)("h2",{className:"wc-block-components-title wc-block-components-checkout-step__title"},(0,n.__)("Pickup point","montonio-for-woocommerce")))),(0,e.createElement)("div",{className:"montonio-pickup-point__container"},(0,e.createElement)("div",{className:"montonio-pickup-point__search"},(0,e.createElement)("div",{className:"montonio-pickup-point__search-logos","data-operators":JSON.stringify(M||[x])}),(0,e.createElement)("input",{ref:v,type:"text",id:"montonio-pickup-point__search-input",className:"montonio-pickup-point__search-input",placeholder:(0,n.__)("Type at least 3 characters to search...","montonio-for-woocommerce"),autoComplete:"off","data-carrier":x||"","data-country":R||"","data-type":z||""})),(0,e.createElement)("div",{className:"montonio-pickup-point__dropdown",id:"montonio-pickup-point__dropdown"}),(0,e.createElement)("div",{className:"montonio-pickup-point__error montonio-pickup-point__error--hidden",id:"montonio-pickup-point__error"})),(0,e.createElement)("input",{type:"hidden",id:"montonio_pickup_point",className:"montonio-pickup-point__selected",name:"montonio-pickup-point"}),!1===C?.hidden&&(0,e.createElement)("div",{className:"wc-block-components-validation-error"},(0,e.createElement)("p",{id:"validate-error-montonio_pickup_point"},(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z"})),(0,e.createElement)("span",null,C.message))),!1===N?.hidden&&(0,e.createElement)("div",{className:"wc-block-components-validation-error"},(0,e.createElement)("p",{id:"validate-error-montonio_pickup_point_cod"},(0,e.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"-2 -2 24 24",width:"24",height:"24","aria-hidden":"true",focusable:"false"},(0,e.createElement)("path",{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm1.13 9.38l.35-6.46H8.52l.35 6.46h2.26zm-.09 3.36c.24-.23.37-.55.37-.96 0-.42-.12-.74-.36-.97s-.59-.35-1.06-.35-.82.12-1.07.35-.37.55-.37.97c0 .41.13.73.38.96.26.23.61.34 1.06.34s.8-.11 1.05-.34z"})),(0,e.createElement)("span",null,N.message)))))}};(0,i.registerCheckoutBlock)(a)})();